<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-cn="NIUMA - æ‰“å¡æ•°æ®" data-en="NIUMA - Check-in Data">NIUMA æ‰“å¡æ•°æ® | ç¤¾åŒºæ´»è·ƒåº¦ç»Ÿè®¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="js/chart.min.js"></script>
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰ä¸»é¢˜   -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF7A00', // æ´»åŠ›æ©™1 - ä»£è¡¨èƒ½é‡ä¸è¡ŒåŠ¨åŠ›
                        secondary: '#1E293B', // æ·±è“ç° - ä»£è¡¨ç¨³é‡ä¸ä¸“ä¸š
                        accent: '#10B981', // ç»¿è‰² - ä»£è¡¨å¢é•¿ä¸å¸Œæœ›
                        dark: '#0F172A',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif']
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .text-shadow-lg {
                text-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
            }
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            .animate-pulse-slow {
                animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .gradient-border {
                background: linear-gradient(45deg, #FF7A00, #10B981);
                padding: 2px;
                border-radius: 12px;
            }
            .gradient-border-content {
                background: #1E293B;
                border-radius: 10px;
                padding: 1.5rem;
            }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        
        .rank-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
        }
        
        .rank-badge.silver {
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
            color: #000;
        }
        
        .rank-badge.bronze {
            background: linear-gradient(135deg, #CD7F32, #B87333);
            color: #fff;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
    <script src="js/language.js"></script>
</head>
<body class="bg-gradient-to-br from-dark to-secondary text-light antialiased">
    <!-- å¯¼èˆªæ  -->
    <div id="header-container"></div>

    <main>
        <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
        <section class="pt-32 pb-16 relative overflow-hidden">
            <!-- èƒŒæ™¯è£…é¥° -->
            <div class="absolute inset-0 overflow-hidden">
                <div class="absolute -top-40 -right-40 w-96 h-96 bg-primary/20 rounded-full filter blur-3xl"></div>
                <div class="absolute top-1/3 -left-20 w-72 h-72 bg-accent/20 rounded-full filter blur-3xl"></div>
            </div>
            
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <div class="text-center max-w-4xl mx-auto">
                    <span class="inline-block px-4 py-2 bg-primary/20 text-primary rounded-full text-sm font-medium mb-4">
                        <i class="fa fa-calendar-check-o mr-2"></i>ç¤¾åŒºæ´»è·ƒåº¦
                    </span>
                    <h1 class="font-display font-bold text-[clamp(2.5rem,5vw,4rem)] leading-tight text-shadow-lg mb-6" data-cn="NIUMA æ‰“å¡æ•°æ®" data-en="NIUMA Check-in Data">
                        NIUMA <span class="text-primary">æ‰“å¡æ•°æ®</span>
                    </h1>
                    <p class="text-light/70 text-lg leading-relaxed" data-cn="è®°å½•æ¯ä¸€ä¸ªç‰›é©¬çš„åšæŒï¼Œè§è¯ç¤¾åŒºçš„æˆé•¿ä¸æ´»åŠ›" data-en="Recording every NIUMA's persistence, witnessing community growth and vitality">
                        è®°å½•æ¯ä¸€ä¸ªç‰›é©¬çš„åšæŒï¼Œè§è¯ç¤¾åŒºçš„æˆé•¿ä¸æ´»åŠ›
                    </p>
                </div>
            </div>
        </section>

        <!-- ä»Šæ—¥æ‰“å¡æ¦‚è§ˆ -->
        <section class="py-16 relative">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid md:grid-cols-3 gap-8 mb-16">
                    <!-- ä»Šæ—¥æ‰“å¡äººæ•° -->
                    <div class="gradient-border">
                        <div class="gradient-border-content text-center">
                            <div class="text-4xl font-bold text-primary mb-2" id="todayCheckins">156</div>
                            <div class="text-light/70 text-sm mb-2" data-cn="ä»Šæ—¥æ‰“å¡äººæ•°" data-en="Today's Check-ins">ä»Šæ—¥æ‰“å¡äººæ•°</div>
                            <div class="text-accent text-xs">
                                <i class="fa fa-arrow-up mr-1"></i>è¾ƒæ˜¨æ—¥ +12%
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ‰“å¡æ€»äººæ•° -->
                    <div class="gradient-border">
                        <div class="gradient-border-content text-center">
                            <div class="text-4xl font-bold text-accent mb-2" id="totalUsers">2,847</div>
                            <div class="text-light/70 text-sm mb-2" data-cn="ç´¯è®¡æ‰“å¡æ€»äººæ•°" data-en="Total Members">ç´¯è®¡æ‰“å¡æ€»äººæ•°</div>
                            <div class="text-primary text-xs">
                                <i class="fa fa-users mr-1"></i>æ´»è·ƒç¤¾åŒºæˆå‘˜
                            </div>
                        </div>
                    </div>
                    
                    <!-- è¿ç»­æ‰“å¡å¤©æ•° -->
                    <div class="gradient-border">
                        <div class="gradient-border-content text-center">
                            <div class="text-4xl font-bold text-yellow-400 mb-2" id="consecutiveDays">89</div>
                            <div class="text-light/70 text-sm mb-2" data-cn="ç¤¾åŒºè¿ç»­æ‰“å¡å¤©æ•°" data-en="Consecutive Days">ç¤¾åŒºè¿ç»­æ‰“å¡å¤©æ•°</div>
                            <div class="text-yellow-400 text-xs">
                                <i class="fa fa-fire mr-1"></i>åšæŒä¸æ‡ˆ
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ä»Šæ—¥æ‰“å¡å‰10å -->
        <section class="py-16 bg-secondary/30">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="font-display font-bold text-3xl mb-4" data-cn="ä»Šæ—¥æ‰“å¡æ’è¡Œæ¦œ" data-en="Today's Check-in Ranking">
                        ä»Šæ—¥æ‰“å¡ <span class="text-primary">æ’è¡Œæ¦œ</span>
                    </h2>
                    <p class="text-light/70" data-cn="æ—©èµ·çš„ç‰›é©¬æœ‰å¥–åŠ±ï¼Œçœ‹çœ‹ä»Šå¤©è°æœ€å‹¤å¥‹" data-en="Early birds get rewards, see who's most diligent today">æ—©èµ·çš„ç‰›é©¬æœ‰å¥–åŠ±ï¼Œçœ‹çœ‹ä»Šå¤©è°æœ€å‹¤å¥‹</p>
                </div>
                
                <div class="max-w-4xl mx-auto">
                    <div class="bg-secondary/50 backdrop-blur-sm rounded-2xl p-8 border border-light/10">
                        <div class="space-y-4" id="dailyRanking">
                            <!-- åŠ¨æ€ç”Ÿæˆæ’è¡Œæ¦œå†…å®¹ -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æœˆåº¦æ’è¡Œæ¦œ -->
        <section class="py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="font-display font-bold text-3xl mb-4" data-cn="æœ¬æœˆæ‰“å¡æ’è¡Œæ¦œ" data-en="Monthly Check-in Ranking">
                        æœ¬æœˆæ‰“å¡ <span class="text-accent">æ’è¡Œæ¦œ</span>
                    </h2>
                    <p class="text-light/70" data-cn="åšæŒå°±æ˜¯èƒœåˆ©ï¼Œçœ‹çœ‹æœ¬æœˆçš„æ‰“å¡ä¹‹ç‹" data-en="Persistence is victory, see this month's check-in champions">åšæŒå°±æ˜¯èƒœåˆ©ï¼Œçœ‹çœ‹æœ¬æœˆçš„æ‰“å¡ä¹‹ç‹</p>
                </div>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- æœˆåº¦å‰10å -->
                    <div class="bg-secondary/50 backdrop-blur-sm rounded-2xl p-8 border border-light/10">
                        <h3 class="font-semibold text-xl mb-6 text-center" data-cn="æœˆåº¦æ’è¡Œæ¦œ" data-en="Monthly Ranking">
                            <i class="fa fa-trophy text-yellow-400 mr-2"></i>æœˆåº¦æ’è¡Œæ¦œ
                        </h3>
                        <div class="space-y-3" id="monthlyRanking">
                            <!-- åŠ¨æ€ç”Ÿæˆæœˆåº¦æ’è¡Œæ¦œå†…å®¹ -->
                        </div>
                    </div>
                    
                    <!-- æ‰“å¡ç»Ÿè®¡å›¾è¡¨ -->
                    <div class="bg-secondary/50 backdrop-blur-sm rounded-2xl p-8 border border-light/10">
                        <h3 class="font-semibold text-xl mb-6 text-center" data-cn="æœ¬æœˆæ‰“å¡è¶‹åŠ¿" data-en="Monthly Check-in Trend">
                            <i class="fa fa-bar-chart text-primary mr-2"></i>æœ¬æœˆæ‰“å¡è¶‹åŠ¿
                        </h3>
                        <div class="h-64">
                            <canvas id="checkinChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ‰“å¡æ¿€åŠ±åŒºåŸŸ -->
        <section class="py-16 bg-gradient-to-r from-primary/20 to-accent/20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center max-w-3xl mx-auto">
                    <h2 class="font-display font-bold text-3xl mb-6" data-cn="åŠ å…¥æ‰“å¡è¡Œåˆ—ï¼Œæˆä¸º NIUMA ç²¾ç¥çš„è·µè¡Œè€…" data-en="Join the Check-in Community, Become a NIUMA Spirit Practitioner">
                        åŠ å…¥æ‰“å¡è¡Œåˆ—ï¼Œæˆä¸º <span class="text-primary">NIUMA</span> ç²¾ç¥çš„è·µè¡Œè€…
                    </h2>
                    <p class="text-light/70 text-lg mb-8" data-cn="æ¯ä¸€æ¬¡æ‰“å¡éƒ½æ˜¯å¯¹è‡ªå·±çš„æ‰¿è¯ºï¼Œæ¯ä¸€å¤©åšæŒéƒ½æ˜¯å¯¹æ¢¦æƒ³çš„è¿½æ±‚" data-en="Every check-in is a commitment to yourself, every day of persistence is a pursuit of dreams">
                        æ¯ä¸€æ¬¡æ‰“å¡éƒ½æ˜¯å¯¹è‡ªå·±çš„æ‰¿è¯ºï¼Œæ¯ä¸€å¤©åšæŒéƒ½æ˜¯å¯¹æ¢¦æƒ³çš„è¿½æ±‚
                    </p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="https://t.me/NIUMANEW" target="_blank">
                            <button class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-full font-medium transition-all transform hover:scale-105 flex items-center gap-2" data-cn="ç«‹å³æ‰“å¡" data-en="Check-in Now">
                                <i class="fa fa-check-circle"></i> ç«‹å³æ‰“å¡
                            </button>
                        </a>
                       
                        <!-- <button class="bg-transparent border border-light/30 hover:border-accent text-light hover:text-accent px-8 py-3 rounded-full font-medium transition-all">
                            <i class="fa fa-calendar"></i> æŸ¥çœ‹æˆ‘çš„è®°å½•
                        </button> -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <div id="footer-container"></div>

    <script src="js/main.js"></script>
    <script src="js/components.js"></script>
    <script src="js/language.js"></script>
    <script src="js/checkin-api.js"></script>
    
    <!--  æ‰“å¡æ•°æ®è„šæœ¬  -->
    <script>
        // å…¨å±€çŠ¶æ€ç®¡ç†
        const appState = {
            loading: {  
                stats: false,
                dailyRanking: false,
                monthlyRanking: false,
                chart: false
            },
            data: {
                stats: null,
                dailyRanking: null,
                monthlyRanking: null,
                chartData: null
            },
            error: null
        };

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(section) {
            appState.loading[section] = true;
            const loadingHTML = `
                <div class="flex items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                    <span class="ml-3 text-light/70">åŠ è½½ä¸­...</span>
                </div>
            `;
            
            switch(section) {
                case 'dailyRanking':
                    document.getElementById('dailyRanking').innerHTML = loadingHTML;
                    break;
                case 'monthlyRanking':
                    document.getElementById('monthlyRanking').innerHTML = loadingHTML;
                    break;
            }
        }

        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showError(section, message) {
            const errorHTML = `
                <div class="flex flex-col items-center justify-center py-8 text-center">
                    <i class="fa fa-exclamation-triangle text-red-400 text-2xl mb-3"></i>
                    <p class="text-light/70 mb-4">${message}</p>
                    <button onclick="retryLoad('${section}')" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg text-sm transition-all">
                        <i class="fa fa-refresh mr-2"></i>é‡è¯•
                    </button>
                </div>
            `;
            
            switch(section) {
                case 'dailyRanking':
                    document.getElementById('dailyRanking').innerHTML = errorHTML;
                    break;
                case 'monthlyRanking':
                    document.getElementById('monthlyRanking').innerHTML = errorHTML;
                    break;
            }
        }

        // é‡è¯•åŠ è½½
        async function retryLoad(section) {
            switch(section) {
                case 'dailyRanking':
                    await loadDailyRanking();
                    break;
                case 'monthlyRanking':
                    await loadMonthlyRanking();
                    break;
                case 'stats':
                    await loadTodayStats();
                    break;
                case 'chart':
                    await loadChartData();
                    break;
            }
        }

        // åŠ è½½ä»Šæ—¥ç»Ÿè®¡æ•°æ®
        async function loadTodayStats() {
            try {
                appState.loading.stats = true;
                const result = await checkinAPI.getTodayStatsWithMock();
                
                if (result.success) {
                    appState.data.stats = result.data;
                    updateStatsDisplay(result.data);
                } else {
                    throw new Error(result.error || 'è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                appState.error = error.message;
                // æ˜¾ç¤ºé»˜è®¤æ•°æ®æˆ–é”™è¯¯æç¤º
                updateStatsDisplay({
                    todayCheckins: '--',
                    totalUsers: '--',
                    consecutiveDays: '--',
                    growthRate: 0
                });
            } finally {
                appState.loading.stats = false;
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
        function updateStatsDisplay(stats) {
            document.getElementById('todayCheckins').textContent = stats.todayCheckins;
            document.getElementById('totalUsers').textContent = stats.totalUsers.toLocaleString();
            document.getElementById('consecutiveDays').textContent = stats.consecutiveDays;
            
            // æ›´æ–°å¢é•¿ç‡æ˜¾ç¤º
            const growthElement = document.querySelector('.text-accent');
            if (growthElement && stats.growthRate !== undefined) {
                growthElement.innerHTML = `<i class="fa fa-arrow-up mr-1"></i>è¾ƒæ˜¨æ—¥ +${stats.growthRate}%`;
            }
        }

        // åŠ è½½ä»Šæ—¥æ’è¡Œæ¦œ
        async function loadDailyRanking() {
            try {
                showLoading('dailyRanking');
                const result = await checkinAPI.getTodayRankingWithMock(10);
                
                if (result.success) {
                    appState.data.dailyRanking = result.data;
                    renderDailyRanking(result.data);
                } else {
                    throw new Error(result.error || 'è·å–ä»Šæ—¥æ’è¡Œæ¦œå¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½ä»Šæ—¥æ’è¡Œæ¦œå¤±è´¥:', error);
                showError('dailyRanking', 'åŠ è½½ä»Šæ—¥æ’è¡Œæ¦œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                appState.loading.dailyRanking = false;
            }
        }

        // åŠ è½½æœˆåº¦æ’è¡Œæ¦œ
        async function loadMonthlyRanking() {
            try {
                showLoading('monthlyRanking');
                const result = await checkinAPI.getMonthlyRankingWithMock(10);
                
                if (result.success) {
                    appState.data.monthlyRanking = result.data;
                    renderMonthlyRanking(result.data);
                } else {
                    throw new Error(result.error || 'è·å–æœˆåº¦æ’è¡Œæ¦œå¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½æœˆåº¦æ’è¡Œæ¦œå¤±è´¥:', error);
                showError('monthlyRanking', 'åŠ è½½æœˆåº¦æ’è¡Œæ¦œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                appState.loading.monthlyRanking = false;
            }
        }

        // åŠ è½½å›¾è¡¨æ•°æ®
        async function loadChartData() {
            try {
                appState.loading.chart = true;
                const result = await checkinAPI.getMonthlyTrendWithMock();
                
                if (result.success) {
                    appState.data.chartData = result.data;
                    initChart(result.data);
                } else {
                    throw new Error(result.error || 'è·å–å›¾è¡¨æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½å›¾è¡¨æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤æ•°æ®åˆå§‹åŒ–å›¾è¡¨
                const defaultData = {
                    labels: Array.from({length: 30}, (_, i) => i + 1),
                    data: Array.from({length: 30}, () => Math.floor(Math.random() * 50) + 100)
                };
                initChart(defaultData);
            } finally {
                appState.loading.chart = false;
            }
        }

        // æ¸²æŸ“ä»Šæ—¥æ’è¡Œæ¦œ
        function renderDailyRanking(data) {
            const container = document.getElementById('dailyRanking');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-light/70" data-cn="æš‚æ— æ•°æ®" data-en="No data available">æš‚æ— æ•°æ®</div>';
                return;
            }
            
            container.innerHTML = data.map(user => {
                let badgeClass = '';
                let icon = '';
                if (user.rank === 1) {
                    badgeClass = 'rank-badge';
                    icon = '<i class="fa fa-crown"></i>';
                } else if (user.rank === 2) {
                    badgeClass = 'rank-badge silver';
                    icon = '<i class="fa fa-medal"></i>';
                } else if (user.rank === 3) {
                    badgeClass = 'rank-badge bronze';
                    icon = '<i class="fa fa-award"></i>';
                } else {
                    badgeClass = 'bg-secondary text-light';
                    icon = user.rank;
                }
                
                return `
                    <div class="flex items-center justify-between p-4 bg-dark/30 rounded-xl hover:bg-dark/50 transition-all">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 ${badgeClass} rounded-full flex items-center justify-center font-bold text-sm">
                                ${icon}
                            </div>
                            <img src="${user.avatar}" alt="${user.name}" class="w-12 h-12 rounded-full border-2 border-primary/30" ">
                            <div>
                                <div class="font-semibold text-light">${user.name}</div>
                                <div class="text-sm text-light/60"><span data-cn="è¿ç»­" data-en="Consecutive">è¿ç»­</span> ${user.streak} <span data-cn="å¤©" data-en="days">å¤©</span></div>
                                <a href="https://x.com/${user.tuite}" target="_blank" class=" text-primary/60 hover:text-primary transition-all">
                                    <i class="fa fa-twitter"></i>
                                </a>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-primary font-semibold">${user.time}</div>
                            <div class="text-xs text-light/60" data-cn="æ‰“å¡æ—¶é—´" data-en="Check-in Time">æ‰“å¡æ—¶é—´</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“æœˆåº¦æ’è¡Œæ¦œ
        function renderMonthlyRanking(data) {
            const container = document.getElementById('monthlyRanking');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-light/70" data-cn="æš‚æ— æ•°æ®" data-en="No data available">æš‚æ— æ•°æ®</div>';
                return;
            }
            
            container.innerHTML = data.map(user => {
                let badgeClass = '';
                let icon = '';
                if (user.rank === 1) {
                    badgeClass = 'rank-badge';
                    icon = '<i class="fa fa-crown"></i>';
                } else if (user.rank === 2) {
                    badgeClass = 'rank-badge silver';
                    icon = '<i class="fa fa-medal"></i>';
                } else if (user.rank === 3) {
                    badgeClass = 'rank-badge bronze';
                    icon = '<i class="fa fa-award"></i>';
                } else {
                    badgeClass = 'bg-secondary text-light';
                    icon = user.rank;
                }
                
                return `
                    <div class="flex items-center justify-between p-3 bg-dark/30 rounded-lg hover:bg-dark/50 transition-all">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 ${badgeClass} rounded-full flex items-center justify-center font-bold text-xs">
                                ${icon}
                            </div>
                            <img src="${user.avatar}" alt="${user.name}" class="w-10 h-10 rounded-full border-2 border-accent/30">
                            <div class="font-medium text-light">${user.name}</div>
                             <a href="https://x.com/${user.tuite}" target="_blank" class=" text-primary/60 hover:text-primary transition-all">
                                    <i class="fa fa-twitter"></i>
                                </a>
                        </div>
                        <div class="text-accent font-semibold">${user.count} <span data-cn="æ¬¡" data-en="times">æ¬¡</span></div>
                    </div>
                `;
            }).join('');
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initChart(chartData) {
            const ctx = document.getElementById('checkinChart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            // å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨å·²æœ‰çš„å›¾è¡¨å®ä¾‹ï¼Œå¦‚æœæœ‰åˆ™é”€æ¯
            if (window.checkinChart && typeof window.checkinChart.destroy === 'function') {
                window.checkinChart.destroy();
            }
            
            window.checkinChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: currentLanguage === 'zh' ? 'æ¯æ—¥æ‰“å¡äººæ•°' : 'Daily Check-in Count',
                        data: chartData.data,
                        borderColor: '#FF7A00',
                        backgroundColor: 'rgba(255, 122, 0, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#FF7A00',
                        pointBorderColor: '#FFFFFF',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#F8FAFC',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#F8FAFC',
                            bodyColor: '#F8FAFC',
                            borderColor: '#FF7A00',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#F8FAFC',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(248, 250, 252, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#F8FAFC',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(248, 250, 252, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshAllData() {
            console.log('ğŸ”„ å¼€å§‹åˆ·æ–°æ‰€æœ‰æ•°æ®...');
            
            // æ¸…é™¤ç¼“å­˜
            checkinAPI.clearAllCache();
            
            // å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®
            await Promise.all([
                loadTodayStats(),
                loadDailyRanking(),
                loadMonthlyRanking(),
                loadChartData()
            ]);
            
            console.log('âœ… æ•°æ®åˆ·æ–°å®Œæˆ');
        }

        // æ·»åŠ åˆ·æ–°æŒ‰é’®åŠŸèƒ½
        function addRefreshButton() {
            const refreshButton = document.createElement('button');
            refreshButton.innerHTML = '<i class="fa fa-refresh mr-2"></i><span data-cn="åˆ·æ–°æ•°æ®" data-en="Refresh Data">åˆ·æ–°æ•°æ®</span>';
            refreshButton.className = 'fixed bottom-6 right-6 bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-full shadow-lg transition-all transform hover:scale-105 z-50';
            refreshButton.onclick = refreshAllData;
            document.body.appendChild(refreshButton);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ åˆå§‹åŒ–æ‰“å¡æ•°æ®é¡µé¢...');
            
            // æ·»åŠ åˆ·æ–°æŒ‰é’®
            addRefreshButton();
            
            // åŠ è½½æ‰€æœ‰æ•°æ®
            await refreshAllData();
            
            console.log('âœ… é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });

        // å®šæ—¶åˆ·æ–°æ•°æ®ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(async () => {
            console.log('â° å®šæ—¶åˆ·æ–°æ•°æ®...');
            await refreshAllData();
        }, 5 * 60 * 1000);

        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶åˆ·æ–°æ•°æ®
        document.addEventListener('visibilitychange', async function() {
            if (!document.hidden) {
                console.log('ğŸ‘ï¸ é¡µé¢é‡æ–°å¯è§ï¼Œåˆ·æ–°æ•°æ®...');
                await refreshAllData();
            }
        });
    </script>
</body>
</html>